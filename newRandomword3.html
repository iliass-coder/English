<script>
    let wordsAndDefinitions = [];

    fetch('https://raw.githubusercontent.com/iliass-coder/English/refs/heads/master/words.json')
        .then(response => response.json())
        .then(data => {
            wordsAndDefinitions = data;
            showRandomWord();
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });

    const isLocalhost = window.location.hostname === 'localhost';
    const baseUrl = isLocalhost ? 'http://localhost:8080' : 'https://english2.onrender.com';

    let currentIndex = -1;

    function showRandomWord() {
        const randomIndex = Math.floor(Math.random() * wordsAndDefinitions.length);
        currentIndex = randomIndex;
        document.getElementById('word').innerText = wordsAndDefinitions[randomIndex].word;
        document.getElementById('definition').style.display = 'none';
        const imgElement = document.getElementById('image');
        if (wordsAndDefinitions[randomIndex].imageUrl) {
            imgElement.src = wordsAndDefinitions[randomIndex].imageUrl;
            imgElement.style.display = 'block';
        } else {
            imgElement.style.display = 'none';
        }
    }

    function showDefinition() {
        if (currentIndex !== -1) {
            document.getElementById('definition').innerText = wordsAndDefinitions[currentIndex].definition;
            document.getElementById('definition').style.display = 'block';
        }
    }

    function showAddWordForm() {
        document.getElementById('addWordForm').style.display = 'flex';
    }

    function hideAddWordForm() {
        document.getElementById('addWordForm').style.display = 'none';
    }

    function addWord() {
        const newWord = document.getElementById('newWord').value;
        const newDefinition = document.getElementById('newDefinition').value;
        const imageInput = document.getElementById('imageUpload');
        const file = imageInput.files[0];

        if (newWord && newDefinition) {
            const newEntry = { word: newWord, definition: newDefinition };
            const formData = new FormData();
            formData.append('wordData', JSON.stringify(newEntry));
            if (file) {
                formData.append('image', file);
            }

            fetch(`${baseUrl}/add-word`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
                wordsAndDefinitions.push(newEntry);
                currentIndex = wordsAndDefinitions.length - 1;
                showDefinition();
                hideAddWordForm();
                document.getElementById('newWord').value = '';
                document.getElementById('newDefinition').value = '';
                document.getElementById('imageUpload').value = '';
            })
            .catch(error => {
                console.error('Error adding word:', error);
                alert('Error adding word');
            });
        } else {
            alert("Invalid input. Word not added.");
        }
    }

    function speak() {
        const msg = new SpeechSynthesisUtterance();
        const wordInput = document.getElementById('word').innerText;

        msg.text = wordInput;
        msg.lang = 'en-US';

        window.speechSynthesis.speak(msg);
    }

    function searchWord() {
        const query = document.getElementById('searchInput').value;
        fetch(`${baseUrl}/search-word?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                const resultsList = document.getElementById('resultsList');
                resultsList.innerHTML = '';
                if (data.length === 0) {
                    resultsList.innerHTML = '<li>No results found</li>';
                } else {
                    data.forEach(entry => {
                        const li = document.createElement('li');
                        li.innerHTML = `<strong>${entry.word}</strong><br>${entry.definition}`;
                        if (entry.imageUrl) {
                            li.innerHTML += `<br><img src="${entry.imageUrl}" alt="Image" style="max-width: 100%;">`;
                        }
                        resultsList.appendChild(li);
                    });
                }
            })
            .catch(error => {
                console.error('Error searching word:', error);
            });
    }
</script>
